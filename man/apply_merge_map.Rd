% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tile_engine.R
\name{apply_merge_map}
\alias{apply_merge_map}
\title{Apply a segment merge map to a segmentation raster (streaming-safe)}
\usage{
apply_merge_map(seg, map, out_file, block_nrows = 1024L)
}
\arguments{
\item{seg}{A `SpatRaster` containing integer segment labels.}

\item{map}{Named integer vector defining the relabeling/merge map. Names are
original segment IDs (as character strings) and values are the target IDs
(typically representatives produced by `merge_by_adjacency()`).}

\item{out_file}{Character. Output file path (GeoTIFF recommended).}

\item{block_nrows}{Integer. Number of rows per streaming block when reading
and writing.}
}
\value{
A file-backed `SpatRaster` pointing to `out_file`.
}
\description{
Applies a mapping from original segment IDs to merged (representative) IDs
and writes the updated segmentation to disk using block-wise streaming.
This is intended for large, file-backed rasters and avoids reading the full
segmentation into memory.
}
\details{
The function streams through `seg` in row blocks, replaces values that match
`names(map)`, and writes the result to `out_file`. Values not present in the
map are left unchanged. `NA` values are preserved.

**terra I/O note.** In terra, `writeStart()` returns a list; this function
intentionally ignores that return value and continues writing to the
`SpatRaster` object used in `writeStart()`. This ensures compatibility with
terra versions where writing to the returned list is incorrect.

The output is written with integer datatype (`INT4S`) and default GDAL
creation options used by the package.
}
\seealso{
`merge_by_adjacency()`, `relabel_segments_global()`,
\code{\link[terra]{readValues}}, \code{\link[terra]{writeValues}}
}
