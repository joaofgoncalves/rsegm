<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Merge adjacent segments by spectral similarity — merge_by_adjacency • rsegm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merge adjacent segments by spectral similarity — merge_by_adjacency"><meta name="description" content="Given a set of adjacent segment ID pairs and per-segment mean feature vectors,
compute a mapping that merges (clusters) segments whose mean vectors are
sufficiently similar. Similarity is evaluated only between segments that are
adjacent (share an edge/corner), and merges are propagated transitively via
a union-find (disjoint-set) structure."><meta property="og:description" content="Given a set of adjacent segment ID pairs and per-segment mean feature vectors,
compute a mapping that merges (clusters) segments whose mean vectors are
sufficiently similar. Similarity is evaluated only between segments that are
adjacent (share an edge/corner), and merges are propagated transitively via
a union-find (disjoint-set) structure."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rsegm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/tiled-segmentation-workflow.html">Tiled segmentation workflow</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/joaofgoncalves/rsegm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Merge adjacent segments by spectral similarity</h1>
      <small class="dont-index">Source: <a href="https://github.com/joaofgoncalves/rsegm/blob/HEAD/R/tile_engine.R" class="external-link"><code>R/tile_engine.R</code></a></small>
      <div class="d-none name"><code>merge_by_adjacency.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a set of adjacent segment ID pairs and per-segment mean feature vectors,
compute a mapping that merges (clusters) segments whose mean vectors are
sufficiently similar. Similarity is evaluated only between segments that are
adjacent (share an edge/corner), and merges are propagated transitively via
a union-find (disjoint-set) structure.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">merge_by_adjacency</span><span class="op">(</span><span class="va">adj_pairs</span>, <span class="va">means</span>, <span class="va">thr</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-adj-pairs">adj_pairs<a class="anchor" aria-label="anchor" href="#arg-adj-pairs"></a></dt>
<dd><p>Integer matrix with two columns. Each row is an undirected
adjacency between segment IDs (e.g., output of `extract_seam_pairs()`).
Pairs may contain duplicates; they do not need to be sorted.</p></dd>


<dt id="arg-means">means<a class="anchor" aria-label="anchor" href="#arg-means"></a></dt>
<dd><p>Numeric matrix of per-segment mean features (e.g., band means).
Row names must be segment IDs as character strings (e.g., `"123"`), and
columns are feature dimensions (bands or derived features).</p></dd>


<dt id="arg-thr">thr<a class="anchor" aria-label="anchor" href="#arg-thr"></a></dt>
<dd><p>Numeric scalar. Merge threshold applied to the Euclidean distance
between mean feature vectors. Adjacent segments with distance `&lt; thr` are
merged into the same component.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An integer vector mapping segment IDs to representative IDs. The
  vector is named by the original segment IDs (as character) and its values
  are the representative IDs (as integer). Only IDs present in `adj_pairs`
  are included. If `adj_pairs` is empty, returns an empty named integer
  vector.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is typically used after extracting seam or boundary adjacencies
(e.g., from tiled segmentations) to reconcile segment IDs across tiles and
reduce seam artifacts by merging regions with near-identical spectral means.</p>

<p>**Algorithm.** For each adjacency `(a, b)`, the function extracts feature
vectors `means[a, ]` and `means[b, ]` and computes their Euclidean distance
`d = sqrt(sum((da - db)^2))`. If `d &lt; thr` and both vectors contain no `NA`,
the segments are unioned in a disjoint-set (union-find) structure. After all
pairs are processed, each segment is assigned to the representative of its
connected component (with path compression to accelerate repeated finds).</p>
<p>**Transitivity.** Because union-find forms connected components, merges are
transitive: if `a` merges with `b` and `b` merges with `c`, then `a`, `b`,
and `c` will share the same representative even if `(a, c)` was never an
explicit adjacency.</p>
<p>**Representatives.** Representatives are chosen by union order (the root in
the union-find structure), not necessarily the smallest ID. If you require
canonical representatives (e.g., minimum ID per component), post-process the
mapping accordingly.</p>
<p>**Robustness.** Pairs whose feature vectors contain `NA` are skipped. Only
IDs appearing in `adj_pairs` are considered; if `means` contains additional
segments not present in `adj_pairs`, they will not appear in the output map.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example adjacency pairs (undirected)</span></span></span>
<span class="r-in"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>, <span class="fl">2</span>,<span class="fl">3</span>, <span class="fl">10</span>,<span class="fl">11</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.11</span>, <span class="fl">0.19</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="fl">0.18</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"10"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="fl">0.75</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"11"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.81</span>, <span class="fl">0.74</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">merge_by_adjacency</span><span class="op">(</span><span class="va">adj</span>, <span class="va">means</span>, thr <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by João Gonçalves.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

