<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tiled segmentation engine with seam-aware merging and global relabeling — segmenter_tile_engine • rsegm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tiled segmentation engine with seam-aware merging and global relabeling — segmenter_tile_engine"><meta name="description" content="Runs a complete tiled segmentation workflow on a large `SpatRaster`:
(1) tile to disk with overlap, (2) segment each tile to disk with globally
unique IDs, (3) detect seam adjacencies, (4) compute per-segment means from
tiles, (5) merge adjacent seam segments by similarity, (6) apply merges
streamingly, and (7) relabel all segments globally to consecutive IDs."><meta property="og:description" content="Runs a complete tiled segmentation workflow on a large `SpatRaster`:
(1) tile to disk with overlap, (2) segment each tile to disk with globally
unique IDs, (3) detect seam adjacencies, (4) compute per-segment means from
tiles, (5) merge adjacent seam segments by similarity, (6) apply merges
streamingly, and (7) relabel all segments globally to consecutive IDs."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rsegm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/tiled-segmentation-workflow.html">Tiled segmentation workflow</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/joaofgoncalves/rsegm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tiled segmentation engine with seam-aware merging and global relabeling</h1>
      <small class="dont-index">Source: <a href="https://github.com/joaofgoncalves/rsegm/blob/HEAD/R/tile_engine.R" class="external-link"><code>R/tile_engine.R</code></a></small>
      <div class="d-none name"><code>segmenter_tile_engine.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Runs a complete tiled segmentation workflow on a large `SpatRaster`:
(1) tile to disk with overlap, (2) segment each tile to disk with globally
unique IDs, (3) detect seam adjacencies, (4) compute per-segment means from
tiles, (5) merge adjacent seam segments by similarity, (6) apply merges
streamingly, and (7) relabel all segments globally to consecutive IDs.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">segmenter_tile_engine</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">segment_fun</span>,</span>
<span>  <span class="va">seg_args</span>,</span>
<span>  tile_size <span class="op">=</span> <span class="fl">2048</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">64</span>,</span>
<span>  seam_thr <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  out_file <span class="op">=</span> <span class="st">"final_seg.tif"</span>,</span>
<span>  tile_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cleanup_tiles <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cleanup_seg_tiles <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A `SpatRaster` to segment (single- or multi-band).</p></dd>


<dt id="arg-segment-fun">segment_fun<a class="anchor" aria-label="anchor" href="#arg-segment-fun"></a></dt>
<dd><p>A function implementing segmentation on a single tile.
Must accept a `SpatRaster` as first argument and return a 1-layer integer
segmentation raster.</p></dd>


<dt id="arg-seg-args">seg_args<a class="anchor" aria-label="anchor" href="#arg-seg-args"></a></dt>
<dd><p>A named list of additional arguments passed to `segment_fun`.</p></dd>


<dt id="arg-tile-size">tile_size<a class="anchor" aria-label="anchor" href="#arg-tile-size"></a></dt>
<dd><p>Integer. Tile size in pixels (rows/cols) excluding buffer.</p></dd>


<dt id="arg-buffer">buffer<a class="anchor" aria-label="anchor" href="#arg-buffer"></a></dt>
<dd><p>Integer. Overlap (in pixels) added around each tile.</p></dd>


<dt id="arg-seam-thr">seam_thr<a class="anchor" aria-label="anchor" href="#arg-seam-thr"></a></dt>
<dd><p>Numeric scalar. Threshold for merging seam-adjacent segments.
Applied to Euclidean distance between per-segment mean feature vectors.</p></dd>


<dt id="arg-out-file">out_file<a class="anchor" aria-label="anchor" href="#arg-out-file"></a></dt>
<dd><p>Character. Output file path for the final segmentation.</p></dd>


<dt id="arg-tile-dir">tile_dir<a class="anchor" aria-label="anchor" href="#arg-tile-dir"></a></dt>
<dd><p>Character. Directory used for intermediate tile products.</p></dd>


<dt id="arg-cleanup-tiles">cleanup_tiles<a class="anchor" aria-label="anchor" href="#arg-cleanup-tiles"></a></dt>
<dd><p>Logical. If `TRUE`, remove the raw image tiles after
segmentation.</p></dd>


<dt id="arg-cleanup-seg-tiles">cleanup_seg_tiles<a class="anchor" aria-label="anchor" href="#arg-cleanup-seg-tiles"></a></dt>
<dd><p>Logical. If `TRUE`, remove segmented tile files once
the final output is produced.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If `TRUE`, print progress messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A file-backed `SpatRaster` pointing to `out_file`, containing a
  1-layer integer segmentation with globally consecutive IDs.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is intended as a robust, memory-safe orchestration layer for
classical OBIA workflows where full-scene segmentation is infeasible in RAM.</p>


<p>See <code><a href="../articles/tiled-segmentation-workflow.html">vignette("tiled-segmentation-workflow")</a></code> for an end-to-end explanation
of the tiling and seam-merge framework.</p>
<p>**Seam-aware merging.** Seam adjacencies are extracted only from the overlap
zone (buffer) of each tile to identify segment labels that touch across tile
borders. Segment means are computed from the original image values using
tile-wise streaming (no VRT reads). Adjacent segments are merged when their
mean vectors are within `seam_thr`, using transitive closure (union-find).</p>
<p>**Fast path when no merges are needed.** If no seam adjacencies are found
(or if all candidate adjacencies are invalid due to missing means), the
function mosaics the segmented tiles directly to `out_file` without merging.</p>
<p>**Streaming-safe output.** Before applying the merge map, the segmented tile
mosaic is materialized to a real file-backed raster to ensure stable block
reads/writes. Merging and final relabeling are performed using streaming
reads/writes to support large rasters.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>[make_tiles_disk()], [segment_tiles()], `make_tile_seam_mask()`,
`extract_seam_pairs()`, [segment_means_from_tiles()],
[merge_by_adjacency()], [apply_merge_map()], [relabel_segments_global()]</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by João Gonçalves.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

